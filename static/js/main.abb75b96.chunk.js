(this["webpackJsonptic-tac-toe"]=this["webpackJsonptic-tac-toe"]||[]).push([[0],{119:function(e,t){},200:function(e,t,n){},202:function(e,t,n){},223:function(e,t){},230:function(e,t){},237:function(e,t){},259:function(e,t){},261:function(e,t){},272:function(e,t){},274:function(e,t){},301:function(e,t){},303:function(e,t){},308:function(e,t){},310:function(e,t){},322:function(e,t){},334:function(e,t){},337:function(e,t){},379:function(e,t,n){"use strict";n.r(t);var r,a,s=n(9),c=n.n(s),o=n(194),i=n.n(o),u=(n(200),n(2)),l=n.n(u),p=n(8),b=n(38),h=(n(202),n(20)),f=n(29),d=n(37),v=n(36),x=n(0),m=function(e){var t=e.value?"https://test.whatsonchain.com/tx/".concat(e.value.tx):"",n=e.value?Object(x.jsx)("div",{className:"squareicon",children:e.value.n}):"";return Object(x.jsxs)("div",{className:"squarewapper",children:[Object(x.jsx)("button",{className:"".concat(e.winnerClass," square"),onClick:e.onClick,children:e.value?Object(x.jsx)("a",{href:t,target:"_blank",title:"Click to see the transaction",children:e.value.label}):e.value}),n]})},w=function(e){Object(d.a)(n,e);var t=Object(v.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"createBoard",value:function(e,t){for(var n=[],r=0,a=0;a<e;a+=1){for(var s=[],c=0;c<t;c+=1)s.push(this.renderSquare(r++));n.push(Object(x.jsx)("div",{className:"board-row",children:s},a))}return n}},{key:"renderSquare",value:function(e){var t=this,n=!this.props.winnerSquares||this.props.winnerSquares[0]!==e&&this.props.winnerSquares[1]!==e&&this.props.winnerSquares[2]!==e?"":"square--green";return Object(x.jsx)(m,{winnerClass:n,value:this.props.squares[e],onClick:function(){return t.props.onClick(e)}},e)}},{key:"render",value:function(){return Object(x.jsx)("div",{children:this.createBoard(3,3)})}}]),n}(c.a.Component),g=n(3);!function(e){e.Testnet="testnet",e.Mainnet="mainnet",e.STN="STN"}(r||(r={})),function(e){e[e.ALL=65]="ALL",e[e.SINGLE=67]="SINGLE",e[e.NONE=66]="NONE",e[e.ANYONECANPAY_ALL=193]="ANYONECANPAY_ALL",e[e.ANYONECANPAY_SINGLE=195]="ANYONECANPAY_SINGLE",e[e.ANYONECANPAY_NONE=194]="ANYONECANPAY_NONE"}(a||(a={}));var j=function e(t){Object(h.a)(this,e),this.network=void 0,this.network=t},y=n(50),O=n.n(y);function k(e,t,n,r,a){t.inputs[n].output=new g.bsv.Transaction.Output({script:a.script,satoshis:a.satoshis});var s=new g.bsv.Transaction.Signature({publicKey:e.publicKey,prevTxId:a.txHash,outputIndex:a.outputIndex,inputIndex:n,signature:g.bsv.Transaction.Sighash.sign(t,e,r,n,t.inputs[n].output.script,t.inputs[n].output.satoshisBN),sigtype:r});return g.bsv.Script.buildPublicKeyHashIn(s.publicKey,s.signature.toDER(),s.sigtype).toHex()}function N(e){var t=new g.bsv.Transaction;return e.inputs.forEach((function(e){t.addInput(new g.bsv.Transaction.Input({prevTxId:e.utxo.txHash,outputIndex:e.utxo.outputIndex,script:e.script?g.bsv.Script.fromHex(e.script):new g.bsv.Script}),g.bsv.Script.fromHex(e.utxo.script),e.utxo.satoshis)})),e.outputs.forEach((function(e){t.addOutput(new g.bsv.Transaction.Output({script:g.bsv.Script.fromHex(e.script),satoshis:e.satoshis}))})),t}function S(e){return N(e).toString()}function I(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.ALL,r=N(e);return Object(g.getPreimage)(r,g.bsv.Script.fromHex(e.inputs[t].utxo.script).toASM(),e.inputs[t].utxo.satoshis,t,n)}var A="0.0.1",P=2e3,L=function(){function e(){Object(h.a)(this,e)}return Object(f.a)(e,null,[{key:"setWallet",value:function(t){e.wallet=t}},{key:"version",value:function(){return A}},{key:"loadContract",value:function(e){return O.a.get(e,{timeout:1e4}).then((function(e){return{contractClass:Object(g.buildContractClass)(e.data),types:Object(g.buildTypeClasses)(e.data)}}))}},{key:"buildDeployTx",value:function(){var t=Object(p.a)(l.a.mark((function t(n,r){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.buildUnsignDeployTx(n,r).then(function(){var t=Object(p.a)(l.a.mark((function t(n){var r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.wallet.signRawTransaction(n,0,a.ALL);case 2:return r=t.sent,n.inputs[0].script=r,t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"appendPayInput",value:function(){var t=Object(p.a)(l.a.mark((function t(n,r){var s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.wallet.getRawChangeAddress();case 2:return s=t.sent,t.abrupt("return",e.wallet.listunspent(r+P,{purpose:"change"}).then(function(){var t=Object(p.a)(l.a.mark((function t(c){var o,i,u;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==c.length){t.next=2;break}throw new Error("no utxos");case 2:return o=n.inputs.length,n.inputs.push({utxo:c[0],script:"",sequence:0}),i=c[0].satoshis-r-P,n.outputs.push({script:g.bsv.Script.buildPublicKeyHashOut(s).toHex(),satoshis:i}),t.next=8,e.wallet.signRawTransaction(n,o,a.ALL);case 8:return u=t.sent,n.inputs[o].script=u,t.abrupt("return",n);case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"buildUnsignDeployTx",value:function(){var t=Object(p.a)(l.a.mark((function t(n,r){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.wallet.getRawChangeAddress();case 2:return a=t.sent,t.abrupt("return",e.wallet.listunspent(r+P,{purpose:"change"}).then(function(){var e=Object(p.a)(l.a.mark((function e(t){var s,c,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}throw new Error("no utxos");case 2:return s={inputs:[],outputs:[]},c={utxo:t[0],sequence:0,script:""},s.inputs.push(c),s.outputs.push({script:n.lockingScript.toHex(),satoshis:r}),o=t[0].satoshis-r-P,s.outputs.push({script:g.bsv.Script.buildPublicKeyHashOut(a).toHex(),satoshis:o}),e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"sendRawTx",value:function(){var t=Object(p.a)(l.a.mark((function t(n){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.wallet.sendRawTransaction(n));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"sendTx",value:function(){var t=Object(p.a)(l.a.mark((function t(n){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.wallet.sendRawTransaction(S(n)));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"deploy",value:function(){var t=Object(p.a)(l.a.mark((function t(n,r){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.buildDeployTx(n,r).then(function(){var t=Object(p.a)(l.a.mark((function t(n){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.sendTx(n));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}]),e}();L.wallet=void 0,console.log("hello, this is scryptlib web3 ".concat(A,"."));var K=function(e){Object(d.a)(n,e);var t=Object(v.a)(n);function n(e,a){var s;return Object(h.a)(this,n),(s=t.call(this,e)).API_PREFIX=void 0,s.privKey=void 0,s.API_PREFIX="https://api.whatsonchain.com/v1/bsv/".concat(e==r.Testnet?"test":"main"),s.privKey=a?new g.bsv.PrivateKey.fromWIF(a):new g.bsv.PrivateKey.fromRandom(e),s}return Object(f.a)(n,[{key:"requestAccount",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getbalance",value:function(){var e=Object(p.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.a.get("".concat(this.API_PREFIX,"/address/").concat(this.privKey.toAddress(),"/balance"),{timeout:5e3});case 2:return t=e.sent,n=t.data,e.abrupt("return",n.confirmed+n.unconfirmed);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"signRawTransaction",value:function(){var e=Object(p.a)(l.a.mark((function e(t,n,r){var a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=N(t),s=t.inputs[n].utxo,e.abrupt("return",k(this.privKey,a,n,r,s));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getSignature",value:function(){var e=Object(p.a)(l.a.mark((function e(t,n,r){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=N(t),e.abrupt("return",Object(g.signTx)(a,this.privKey,a.inputs[n].output.script.toASM(),a.inputs[n].output.satoshisBN,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sendRawTransaction",value:function(){var e=Object(p.a)(l.a.mark((function e(t){var n,r,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Math.max(1,t.length/2/1024),r=Math.max(1e4,1e3*n),e.next=4,O.a.post("".concat(this.API_PREFIX,"/tx/raw"),{txhex:t},{timeout:r});case 4:return a=e.sent,s=a.data,e.abrupt("return",s);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"listunspent",value:function(){var e=Object(p.a)(l.a.mark((function e(t,n){var r=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",O.a.get("".concat(this.API_PREFIX,"/address/").concat(this.privKey.toAddress(),"/unspent"),{timeout:1e4}).then((function(e){return e.data.filter((function(e){return e.value>=t})).map((function(e){return{txHash:e.tx_hash,outputIndex:e.tx_pos,satoshis:e.value,script:g.bsv.Script.buildPublicKeyHashOut(r.privKey.toAddress()).toHex()}}))})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getRawChangeAddress",value:function(e){var t=this;return new Promise((function(e){return e(t.privKey.toAddress()+"")}))}},{key:"getPublicKey",value:function(e){var t=this;return new Promise((function(e){return e(Object(g.toHex)(t.privKey.publicKey))}))}}]),n}(j),C=n(79),T=new(function(e){Object(d.a)(n,e);var t=Object(v.a)(n);function n(){var e;Object(h.a)(this,n),(e=t.call(this)).player="",e.privKey="",e.existGamebySelf=function(){var t=window.localStorage.getItem("game");if(t&&null!==t&&(t=JSON.parse(t)).creator&&t.creator===e.player)return t},e.existGamebyOther=function(){var t=window.localStorage.getItem("game");if(t&&null!==t&&(t=JSON.parse(t)).creator&&t.creator!==e.player)return t},e.deleteGame=function(){console.log("deleteGame"),window.localStorage.removeItem("game")},e.createGame=function(e){return e.event="createGame",console.log("createGame",e),window.localStorage.setItem("game",JSON.stringify(e))},e.saveGame=function(e,t){e.event=t,console.log("saveGame",e),window.localStorage.setItem("game",JSON.stringify(e))},e.getGame=function(){var e=window.localStorage.getItem("game");if(e&&null!==e)return JSON.parse(e)},e.getIdentity=function(){return e.player},e.savePrivateKey=function(t){e.privKey=t,window.localStorage.setItem(e.player,t)},e.getPrivateKey=function(){return e.player&&(e.privKey=window.localStorage.getItem(e.player)),e.privKey};var r=new URLSearchParams(window.location.search);e.player=r.get("player")||"alice";var a=Object(C.a)(e);return window.addEventListener("storage",(function(t){if(console.log("on storage change "+e.player,t),"game"===t.key)try{var n=window.localStorage.getItem("game");if(n&&null!==n){var r=JSON.parse(n);r.event&&a.emit(r.event,r)}}catch(t){console.error(" storage change error",t)}}),!1),e}return Object(f.a)(n,[{key:"addJoinListener",value:function(e){console.log("addJoinListener"),this.on("JoinGame",e)}},{key:"removeJoinListener",value:function(e){console.log("removeJoinListener"),this.off("JoinGame",e)}},{key:"addAliceSignListener",value:function(e){console.log("addAliceSignListener"),this.on("AliceSign",e)}},{key:"removeAliceSignListener",value:function(e){console.log("removeAliceSignListener"),this.off("AliceSign",e)}},{key:"addDeployedListener",value:function(e){console.log("addDeployedListener"),this.on("deployed",e)}},{key:"removeDeployedListener",value:function(e){console.log("removeDeployedListener"),this.off("deployed",e)}},{key:"addNextListener",value:function(e){console.log("addNextListener"),this.on("next",e)}},{key:"removeNextListener",value:function(e){console.log("removeNextListener"),this.off("next",e)}}]),n}(n(41).EventEmitter)),E=function(e){for(var t=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],n=0;n<t.length;n+=1){var r=Object(b.a)(t[n],3),a=r[0],s=r[1],c=r[2];if(e[a]&&e[s]&&e[c]&&e[a].label===e[s].label&&e[a].label===e[c].label)return{winner:e[a],winnerRow:t[n]}}return{winner:null,winnerRow:null}},H={history:[{squares:Array(9).fill(null)}],currentStepNumber:0,xIsNext:!0},R=function(e){Object(d.a)(n,e);var t=Object(v.a)(n);function n(e){var r;return Object(h.a)(this,n),r=t.call(this,e),e.game&&e.game.gameState?r.state=e.game.gameState:r.state=H,r}return Object(f.a)(n,[{key:"componentWillReceiveProps",value:function(e){console.log("componentWillReceiveProps",e),e.game&&e.game.gameState?this.setState(e.game.gameState):this.setState(H)}},{key:"componentDidMount",value:function(){var e=Object(p.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("componentDidMount",this.props);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){}},{key:"handleClick",value:function(){var e=Object(p.a)(l.a.mark((function e(t){var n,r,s,c,o,i,u,p,b,h,f,d,v,x,m,w,j,y=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.game&&this.props.game.lastUtxo){e.next=3;break}return console.error("handleClick error",this.props.game),e.abrupt("return");case 3:if(n=this.state.history.slice(0,this.state.currentStepNumber+1),r=n[n.length-1],s=r.squares.slice(),!E(s).winner&&!s[t]){e.next=8;break}return e.abrupt("return");case 8:if(s[t]={label:this.state.xIsNext?"X":"O"},"alice"!==(c=T.getIdentity())||!this.state.xIsNext){e.next=13;break}e.next=19;break;case 13:if("bob"!==c||this.state.xIsNext){e.next=16;break}e.next=19;break;case 16:return alert("now is ".concat(this.state.xIsNext?"Alice":"Bob"," turn ")),console.error("now is ".concat(this.state.xIsNext?"Alice":"Bob"," turn , but got ").concat(c)),e.abrupt("return");case 19:if(o=(this.state.xIsNext?"01":"00")+s.map((function(e){return e&&"X"===e.label?"01":e&&"O"===e.label?"02":"00"})).join(""),i="",u=E(s).winner,p=3e3,b=[],h=this.props.game.lastUtxo.satoshis-p,!u){e.next=33;break}return e.next=28,L.wallet.getRawChangeAddress();case 28:f=e.sent,i=g.bsv.Script.buildPublicKeyHashOut(f).toHex(),b.push({satoshis:h,script:i}),e.next=34;break;case 33:n.length>=9?(d=new g.bsv.PublicKey(this.props.game.alicePubKey,{network:g.bsv.Networks.testnet}),v=new g.bsv.PublicKey(this.props.game.bobPubKey,{network:g.bsv.Networks.testnet}),x=g.bsv.Script.buildPublicKeyHashOut(d.toAddress(g.bsv.Networks.testnet)).toHex(),m=g.bsv.Script.buildPublicKeyHashOut(v.toAddress(g.bsv.Networks.testnet)).toHex(),h=(this.props.game.lastUtxo.satoshis-p)/2,b.push({satoshis:h,script:x}),b.push({satoshis:h,script:m})):(i=[this.props.contractInstance.codePart.toHex(),g.bsv.Script.fromASM(o).toHex()].join(""),b.push({satoshis:h,script:i}));case 34:w={inputs:[{utxo:this.props.game.lastUtxo,sequence:0,script:""}],outputs:b},j=I(w),L.wallet.getSignature(w,0,a.ALL,!0).then((function(e){var r=y.props.contractInstance.move(t,new g.Sig(Object(g.toHex)(e)),h,j).toHex();w.inputs[0].script=r,L.sendTx(w).then((function(e){s[t].tx=e,s[t].n=n.length;var r,a={history:n.concat([{squares:s,currentLocation:(r=t,{0:"row: 1, col: 1",1:"row: 1, col: 2",2:"row: 1, col: 3",3:"row: 2, col: 1",4:"row: 2, col: 2",5:"row: 2, col: 3",6:"row: 3, col: 1",7:"row: 3, col: 2",8:"row: 3, col: 3"}[r]),stepNumber:n.length}]),xIsNext:!y.state.xIsNext,currentStepNumber:n.length};T.saveGame(Object.assign({},y.props.game,{gameState:a,lastUtxo:{txHash:e,outputIndex:0,satoshis:w.outputs[0].satoshis,script:w.outputs[0].script}}),"next"),y.setState(a)})).catch((function(e){e.response&&alert("sendTx errror: "+e.response.data),console.error("sendTx errror",e.response)}))}));case 37:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e,t,n,r,a=this,s=this.state.history,c=s[this.state.currentStepNumber],o=E(c.squares),i=o.winner,u=o.winnerRow,l=T.getGame();n="bob"===T.getIdentity()?Object(x.jsxs)("div",{className:"bob",children:["Bob",Object(x.jsx)("img",{src:"/tic-tac-toe/bob.png"})]}):Object(x.jsxs)("div",{className:"alice",children:["Alice",Object(x.jsx)("img",{src:"/tic-tac-toe/alice.jpg"})]}),l&&l.deploy&&(r=Object(x.jsxs)("div",{className:"bet",children:[Object(x.jsx)("a",{href:"https://test.whatsonchain.com/tx/".concat(l.deploy),target:"_blank",children:"Bet transaction"})," "]}));T.getIdentity();if(i){var p="X"===i.label?"Alice":"Bob";e="Winner is ".concat(p),l&&l.lastUtxo&&(t=Object(x.jsxs)("div",{className:"end",children:[Object(x.jsx)("a",{href:"https://test.whatsonchain.com/tx/".concat(l.lastUtxo.txHash),target:"_blank",children:"Withdraw transaction"})," "]}))}else if(10===s.length)e="Draw. No one won.",l&&l.lastUtxo&&(t=Object(x.jsxs)("div",{className:"end",children:[Object(x.jsx)("a",{href:"https://test.whatsonchain.com/tx/".concat(l.lastUtxo.txHash),target:"_blank",children:"Withdraw transaction"})," "]}));else{var b=this.state.xIsNext?"Alice":"Bob";e="Next player: ".concat(b)}return Object(x.jsx)("div",{className:"game",children:Object(x.jsxs)("div",{className:"game-board",children:[Object(x.jsxs)("div",{className:"game-title",children:[n,Object(x.jsxs)("div",{className:"game-status",children:[" ",e," "]})]}),Object(x.jsx)(w,{squares:c.squares,winnerSquares:u,onClick:function(e){return a.handleClick(e)}}),Object(x.jsxs)("div",{className:"game-bottom",children:[r,t]})]})})}}]),n}(c.a.Component);var G=function(e){c.a.useReducer((function(e){return!e}))[1];var t=Object(s.useRef)(null),n=function(t){e.cancelBet()};return Object(s.useEffect)((function(){})),e.started?Object(x.jsxs)("div",{children:["The game is in progress ...",Object(x.jsx)("button",{className:"pure-button cancel",onClick:n,children:"Restart"})]}):T.existGamebySelf()?Object(x.jsxs)("div",{children:["Waiting someone join the game ...",Object(x.jsx)("a",{className:"pure-button",href:window.location.href+"?player=bob",target:"_blank",children:" Join"}),Object(x.jsx)("button",{className:"pure-button cancel",onClick:n,children:"Restart"})]}):T.existGamebyOther()?Object(x.jsx)("div",{children:"Joining the game..."}):Object(x.jsxs)("div",{children:[Object(x.jsxs)("label",{children:["Bet amount:",Object(x.jsx)("input",{ref:t,type:"number",name:"amount",placeholder:"in satoshis"})]}),Object(x.jsx)("button",{className:"start",onClick:function(n){if(L.wallet){var r=parseInt(t.current.value);r<1e4?alert("The bet fund is too small to play, at least 10000"):isNaN(r)?console.error("".concat(t.current.value," is not number")):e.startBet(r)}else alert("Pelease create wallet first")},children:"Start Bet"})]})},q=n(195);var B=function(e){var t=Object(s.useState)(""),n=Object(b.a)(t,2),a=n[0],c=n[1],o=Object(s.useState)(0),i=Object(b.a)(o,2),u=i[0],l=i[1];Object(s.useEffect)((function(){L.wallet?(L.wallet.getRawChangeAddress().then((function(e){c(e)})),L.wallet.getbalance().then((function(e){l(e)}))):T.getPrivateKey()&&(L.setWallet(new K(r.Testnet,T.getPrivateKey())),e.updateWallet())})),function(e,t){var n=Object(s.useRef)();Object(s.useEffect)((function(){n.current=e})),Object(s.useEffect)((function(){var e=setInterval((function(){n.current()}),t);return function(){return clearInterval(e)}}),[t])}((function(){L.wallet&&L.wallet.getbalance().then((function(e){console.log("update balance old: ".concat(u," new: ").concat(e)),0===u&&e>0&&alert("Successfully deposit, try F5 to reload the page"),l(e)}))}),5e3);return L.wallet?Object(x.jsxs)("div",{className:"wallet",children:[Object(x.jsxs)("div",{className:"walletInfo",children:[Object(x.jsx)("div",{className:"address",children:Object(x.jsxs)("label",{children:["Address: ",a]})}),Object(x.jsx)("div",{className:"balance",children:Object(x.jsxs)("label",{children:["Balance: ",u]})}),Object(x.jsx)("div",{className:"fundtips",children:Object(x.jsxs)("label",{children:["You can fund the address with ",Object(x.jsx)("a",{href:"https://faucet.bitcoincloud.net",target:"_blank",children:Object(x.jsx)("span",{children:" faucets"})})]})})]}),Object(x.jsx)("div",{className:"walletqrcode",children:Object(x.jsx)(q,{value:a})})]}):Object(x.jsx)("div",{className:"wallet",children:Object(x.jsx)("button",{className:"pure-button button-large",onClick:function(t){try{var n=new g.bsv.PrivateKey.fromRandom("testnet");L.setWallet(new K(r.Testnet,n.toWIF())),T.savePrivateKey(n.toWIF()),e.updateWallet()}catch(t){console.log("wallet onChange error",t)}},children:"Create Wallet"})})};var D=function(){var e=Object(s.useState)(!1),t=Object(b.a)(e,2),n=t[0],r=t[1],o=Object(s.useState)(null),i=Object(b.a)(o,2),u=i[0],h=i[1],f=c.a.useReducer((function(e){return!e}))[1],d=function(){var e=Object(p.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("startBet with amount",t),"bob"!==T.getIdentity()){e.next=4;break}return alert("Only Alice can start bet"),e.abrupt("return");case 4:if(!L.wallet){e.next=16;break}return e.next=7,L.wallet.getbalance();case 7:if(n=e.sent,!(t>n)){e.next=11;break}return alert("Please fund your wallet address first"),e.abrupt("return");case 11:return e.next=13,L.wallet.getPublicKey();case 13:r=e.sent,T.createGame({amount:t,tx:{inputs:[],outputs:[]},name:"tic-tac-toe",alicePubKey:r,bobPubKey:"",creator:"alice",player:"",date:new Date}),f();case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=Object(p.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onBobJoin",t),"alice"!==t.creator||"alice"!==T.getIdentity()){e.next=9;break}return e.next=4,L.appendPayInput(t.tx,t.amount);case 4:n=e.sent,t.tx=n,T.saveGame(t,"AliceSign"),e.next=10;break;case 9:r(!0);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=Object(p.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("alice"!==t.creator||"bob"!==T.getIdentity()){e.next=7;break}return console.log("onAliceSign",t),e.next=4,L.wallet.signRawTransaction(t.tx,0,a.ALL);case 4:n=e.sent,t.tx.inputs[0].script=n,L.sendTx(t.tx).then((function(e){t.lastUtxo={txHash:e,outputIndex:0,satoshis:t.tx.outputs[0].satoshis,script:t.tx.outputs[0].script},t.deploy=e,T.saveGame(t,"deployed"),r(!0)}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=Object(p.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"alice"===t.creator&&"alice"===T.getIdentity()?(console.log("onDeployed",t),y(t),r(!0)):console.warn("onDeployed but not receive by Alice",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=Object(p.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("onNext",t),f();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function y(e){return O.apply(this,arguments)}function O(){return(O=Object(p.a)(l.a.mark((function e(t){var n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null===u&&t&&t.bobPubKey&&t.alicePubKey)){e.next=10;break}return e.next=3,L.loadContract("/tic-tac-toe/tictactoe_desc.json");case 3:return n=e.sent,r=n.contractClass,(a=Object(g.newCall)(r,[new g.PubKey(Object(g.toHex)(t.alicePubKey)),new g.PubKey(Object(g.toHex)(t.bobPubKey))])).setDataPart(t.state?t.state:"00000000000000000000"),console.log("fetchContract",a),h(a),e.abrupt("return",a);case 10:return console.log("fetchContract null"),e.abrupt("return",u);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(s.useEffect)((function(){var e=T.getGame();function t(){return(t=Object(p.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.wallet.getPublicKey();case 2:return n=e.sent,e.next=5,L.wallet.getbalance();case 5:if(!(e.sent<=t.amount)){e.next=9;break}return alert("no available utxos or  balance is not enough, please fund your wallet"),e.abrupt("return");case 9:return t=Object.assign(t,{bobPubKey:n,player:"Bob"}),e.next=12,y(t);case 12:r=e.sent,console.log("bobJoin fetchContract",r),null!=r&&L.buildUnsignDeployTx(r,t.amount).then((function(e){e.outputs[0].satoshis=2*t.amount,T.saveGame(Object.assign(t,{tx:e}),"JoinGame")})).catch((function(e){"no utxos"===e.message&&alert("no available utxos, please fund your wallet"),console.error("buildUnsignDeployTx error",e)}));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return e&&e.lastUtxo&&r(!0),"bob"===T.getIdentity()&&e&&!e.deploy?L.wallet?function(e){t.apply(this,arguments)}(e):setTimeout((function(){alert("Please create your wallet and fund it")}),1e3):y(e),T.addJoinListener(v),T.addAliceSignListener(m),T.addDeployedListener(w),T.addNextListener(j),function(){T.removeAliceSignListener(m),T.removeDeployedListener(w),T.removeJoinListener(v),T.removeNextListener(j)}}),[u]);var k=T.getGame();return Object(x.jsx)("div",{className:"App",children:Object(x.jsxs)("header",{className:"App-header",children:[Object(x.jsx)("h2",{children:"Play Tic-Tac-Toe on Bitcoin"}),Object(x.jsx)(G,{startBet:d,cancelBet:function(){T.deleteGame(),r(!1),f()},started:n,game:k}),Object(x.jsx)(R,{game:k,contractInstance:u}),Object(x.jsx)(B,{updateWallet:function(){f()}})]})})},J=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,380)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,s=t.getLCP,c=t.getTTFB;n(e),r(e),a(e),s(e),c(e)}))};i.a.render(Object(x.jsx)(c.a.StrictMode,{children:Object(x.jsx)(D,{})}),document.getElementById("root")),J()}},[[379,1,2]]]);
//# sourceMappingURL=main.abb75b96.chunk.js.map